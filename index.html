<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>T2DM Equity-Efficiency Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Include Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Include jsPDF CDN for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>T2DM Equity-Efficiency Decision Aid Tool</h1>
      <p>Assessing Health Plan Choices Based on Cost, Efficacy, and Risk Attributes</p>
    </header>

    <nav>
      <div class="tabs" role="tablist">
        <button class="tablink active" onclick="openTab('introTab', this)" role="tab" aria-selected="true" aria-controls="introTab" id="tab-intro">Introduction</button>
        <button class="tablink" onclick="openTab('wtpTab', this)" role="tab" aria-selected="false" aria-controls="wtpTab" id="tab-wtp">WTP Results</button>
        <button class="tablink" onclick="openTab('inputsTab', this)" role="tab" aria-selected="false" aria-controls="inputsTab" id="tab-inputs">Inputs</button>
        <button class="tablink" onclick="openTab('attributesTab', this)" role="tab" aria-selected="false" aria-controls="attributesTab" id="tab-attributes">Attributes</button>
        <button class="tablink" onclick="openTab('costsTab', this)" role="tab" aria-selected="false" aria-controls="costsTab" id="tab-costs">Costs & Benefits</button>
        <button class="tablink" onclick="openTab('scenariosTab', this)" role="tab" aria-selected="false" aria-controls="scenariosTab" id="tab-scenarios">Saved Scenarios</button>
      </div>
    </nav>

    <!-- Introduction Tab -->
    <div id="introTab" class="tabcontent" role="tabpanel" aria-labelledby="tab-intro" style="display: block;">
      <h2>Introduction</h2>
      <p>Welcome to the T2DM Equity-Efficiency Decision Aid Tool. This tool helps evaluate health plan choices based on various attributes such as cost, efficacy, and risk. Navigate through the tabs to explore different functionalities.</p>
    </div>

    <!-- WTP Results Tab -->
    <div id="wtpTab" class="tabcontent" role="tabpanel" aria-labelledby="tab-wtp">
      <h2>Willingness to Pay (WTP) Results</h2>
      <button onclick="renderWTPChart()">Show WTP Plots</button>
      <div class="chart-grid">
        <div class="chart-box">
          <h3>WTP for Risk Attributes</h3>
          <canvas id="wtpChartMain"></canvas>
        </div>
      </div>
    </div>

    <!-- Inputs Tab -->
    <div id="inputsTab" class="tabcontent" role="tabpanel" aria-labelledby="tab-inputs">
      <h2>Inputs</h2>
      <div class="form-grid">
        <div class="form-item">
          <label for="experimentSelect">Select Experiment:</label>
          <select id="experimentSelect" onchange="toggleExperimentAttributes()">
            <option value="">--Select Experiment--</option>
            <option value="1">Experiment 1</option>
            <option value="2">Experiment 2</option>
            <option value="3">Experiment 3</option>
          </select>
        </div>
        <div class="form-item">
          <label for="efficacy">Efficacy (%):</label>
          <input type="range" id="efficacy" min="0" max="100" value="50" onchange="updateEfficacyDisplay(this.value); predictUptake();">
          <span id="efficacyValue">50%</span>
        </div>
        <div class="form-item">
          <label for="risk">Risk (%):</label>
          <input type="range" id="risk" min="0" max="100" value="8" onchange="updateRiskDisplay(this.value); predictUptake();">
          <span id="riskValue">8%</span>
        </div>
        <div class="form-item">
          <label for="cost">Monthly Out-of-Pocket Cost (USD):</label>
          <input type="range" id="cost" min="0" max="1000" step="10" value="500" onchange="updateCostDisplay(this.value); predictUptake();">
          <span id="costValue">$500</span>
        </div>
        <!-- Experiment 3 Additional Attributes -->
        <div class="form-item" id="efficacyOthersDiv" style="display: none;">
          <label for="efficacyOthers">Efficacy Others (%):</label>
          <input type="range" id="efficacyOthers" min="0" max="100" value="50" onchange="updateEfficacyOthersDisplay(this.value); predictUptake();">
          <span id="efficacyOthersValue">50%</span>
        </div>
        <div class="form-item" id="riskOthersDiv" style="display: none;">
          <label for="riskOthers">Risk Others (%):</label>
          <input type="range" id="riskOthers" min="0" max="100" value="8" onchange="updateRiskOthersDisplay(this.value); predictUptake();">
          <span id="riskOthersValue">8%</span>
        </div>
        <div class="form-item" id="costOthersDiv" style="display: none;">
          <label for="costOthers">Monthly Out-of-Pocket Cost Others (USD):</label>
          <input type="range" id="costOthers" min="0" max="1000" step="10" value="500" onchange="updateCostOthersDisplay(this.value); predictUptake();">
          <span id="costOthersValue">$500</span>
        </div>
      </div>
      <button onclick="predictUptake()">Predict Health Plan Uptake Probability</button>
      <div class="chart-grid">
        <div class="chart-box">
          <h3>Health Plan Uptake Probability</h3>
          <canvas id="probChartMain"></canvas>
        </div>
      </div>
      <div class="buttons-row">
        <button onclick="saveScenario()">Save Scenario</button>
      </div>
    </div>

    <!-- Attributes Tab -->
    <div id="attributesTab" class="tabcontent" role="tabpanel" aria-labelledby="tab-attributes">
      <h2>Attributes</h2>
      <div class="attributes-list">
        <div class="attribute-card">
          <div class="attribute-icon">
            <!-- Info Icon SVG -->
            <svg width="16" height="16" viewBox="0 0 24 24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
              <line x1="12" y1="16" x2="12" y2="12" stroke="#2980b9" stroke-width="2"/>
              <circle cx="12" cy="8" r="1" fill="#2980b9"/>
            </svg>
            <div class="tooltip">
              <strong>Efficacy:</strong> The effectiveness of the health plan in managing T2DM.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Efficacy</h4>
            <p>Measures how well the health plan manages T2DM.</p>
            <ul>
              <li>50% Efficacy</li>
              <li>90% Efficacy</li>
            </ul>
          </div>
        </div>
        <!-- Repeat similar blocks for Risk and Cost Attributes -->
        <div class="attribute-card">
          <div class="attribute-icon">
            <!-- Info Icon SVG -->
            <svg width="16" height="16" viewBox="0 0 24 24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
              <line x1="12" y1="16" x2="12" y2="12" stroke="#2980b9" stroke-width="2"/>
              <circle cx="12" cy="8" r="1" fill="#2980b9"/>
            </svg>
            <div class="tooltip">
              <strong>Risk:</strong> The probability of adverse effects associated with the health plan.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Risk</h4>
            <p>Represents the likelihood of experiencing side effects.</p>
            <ul>
              <li>8% Risk</li>
              <li>16% Risk</li>
              <li>30% Risk</li>
            </ul>
          </div>
        </div>
        <div class="attribute-card">
          <div class="attribute-icon">
            <!-- Info Icon SVG -->
            <svg width="16" height="16" viewBox="0 0 24 24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
              <line x1="12" y1="16" x2="12" y2="12" stroke="#2980b9" stroke-width="2"/>
              <circle cx="12" cy="8" r="1" fill="#2980b9"/>
            </svg>
            <div class="tooltip">
              <strong>Cost:</strong> The monthly out-of-pocket expense for the health plan.
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cost</h4>
            <p>The financial burden of the health plan on the participant.</p>
            <ul>
              <li>$0 - $1000</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Costs & Benefits Tab -->
    <div id="costsTab" class="tabcontent" role="tabpanel" aria-labelledby="tab-costs">
      <h2>Costs &amp; Benefits</h2>
      <div id="costsBenefitsContainer">
        <div class="qaly-selector">
          <label for="qalySelect"><strong>Select QALY Gain Scenario:</strong></label>
          <select id="qalySelect" onchange="renderCostsBenefits()">
            <option value="low">Low (0.02 QALYs per participant)</option>
            <option value="moderate" selected>Moderate (0.05 QALYs per participant)</option>
            <option value="high">High (0.1 QALYs per participant)</option>
          </select>
        </div>
        <div id="costsBenefitsResults">
          <!-- Results will be injected here -->
          <p class="description">
            The cost components are derived from a targeted literature review focusing on various aspects such as advertisement, training, medication, and healthcare provider visits. Benefits are calculated based on the selected Quality-Adjusted Life Year (QALY) gain scenario and monetized using a standard value per QALY.
          </p>
          <!-- Added info about how costs and benefits are calculated -->
          <div class="calculation-info">
            <h4>How Costs and Benefits are Calculated:</h4>
            <p>
              <strong>Costs:</strong> Each cost item has a predefined unit cost based on literature reviews. Fixed costs are added directly, while variable costs are scaled based on the predicted Health Plan Uptake Probability. The total treatment cost is the sum of all these costs.
            </p>
            <p>
              <strong>Benefits:</strong> Benefits are calculated by multiplying the number of participants (based on uptake probability) by the selected QALY gain per participant. These QALYs are then monetized using a standard value per QALY (USD 50,000) to derive the monetized benefits.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Scenarios Tab -->
    <div id="scenariosTab" class="tabcontent" role="tabpanel" aria-labelledby="tab-scenarios">
      <h2>Saved Scenarios</h2>
      <p>
        Save your scenario from <strong>Inputs</strong> and compare or export multiple configurations, including WTP and uptake probability charts, to PDF.
      </p>
      <div class="filter-options">
        <!-- Filter Icon SVG -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg" class="filter-icon" aria-hidden="true">
          <polygon points="3,4 21,4 14,11 17,11 21,16 3,16 7,11 10,11"/>
        </svg>
        <label for="filterExperiment"><strong>Filter by Experiment:</strong></label>
        <select id="filterExperiment" onchange="filterScenarios()">
          <option value="all">All Experiments</option>
          <option value="Experiment 1">Experiment 1</option>
          <option value="Experiment 2">Experiment 2</option>
          <option value="Experiment 3">Experiment 3</option>
        </select>
        <!-- Removed Filter by Uptake Probability as per user request -->
      </div>
      <div class="buttons-row">
        <button onclick="renderWTPComparison()">Compare Average WTP for Risk Across Experiments</button>
        <button onclick="exportToPDF()">Export Comparison to PDF</button>
      </div>
      <table id="scenarioTable" aria-describedby="scenarioTable-description">
        <caption id="scenarioTable-description" class="sr-only">Table of saved scenarios with details</caption>
        <thead>
          <tr>
            <th>Name</th>
            <th>Experiment</th>
            <th>Efficacy (%)</th>
            <th>Risk (%)</th>
            <th>Cost (USD)</th>
            <th>Efficacy Others (%)</th>
            <th>Risk Others (%)</th>
            <th>Cost Others (USD)</th>
            <th>Uptake (%)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- WTP Comparison Chart -->
      <div id="wtpComparisonContainer" style="margin-top: 40px; display: none;">
        <h3>Average WTP for Risk Attributes Across Experiments</h3>
        <canvas id="wtpComparisonChart"></canvas>
        <p id="wtpComparisonConclusion" class="conclusion-section"></p>
      </div>
    </div>

    <footer>
      <p>
        &copy; 2025 T2DM Equity-Efficiency Decision Aid Tool. All Rights Reserved. <br/>
        Authors: Surachat Ngorsuraches (Auburn University, USA), Mesfin Genie (The University of Newcastle, Australia)
      </p>
    </footer>
  </div>
  <script src="script.js"></script>
</body>
</html>
