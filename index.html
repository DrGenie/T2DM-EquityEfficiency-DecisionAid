<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>T2DM Equity-Efficiency Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="container">
  <header>
    <h1>T2DM Equity-Efficiency Decision Aid Tool</h1>
    <p>Assessing patient preferences for health insurance plans covering newer T2DM treatments.</p>
  </header>

  <div class="tabs">
    <button class="tablink active" onclick="openTab('introTab', this)">Introduction</button>
    <button class="tablink" onclick="openTab('instructionsTab', this)">Instructions</button>
    <button class="tablink" onclick="openTab('attributesTab', this)">Attributes</button>
    <button class="tablink" onclick="openTab('inputsTab', this)">Inputs</button>
    <button class="tablink" onclick="openTab('wtpTab', this)">WTP Results</button>
    <button class="tablink" onclick="openTab('probTab', this)">Programme Uptake Probability</button>
    <button class="tablink" onclick="openTab('costsTab', this)">Costs & Benefits</button>
    <button class="tablink" onclick="openTab('scenariosTab', this)">Scenarios</button>
  </div>

  <!-- Introduction Tab -->
  <div id="introTab" class="tabcontent" style="display: block;">
    <div class="intro-box">
      <p>
        Welcome to the T2DM Equity-Efficiency Decision Aid Tool. This tool is designed to help patients with Type 2 Diabetes Mellitus (T2DM) evaluate and understand their preferences for different health insurance plans covering newer T2DM treatments. By considering various attributes under different experimental conditions of equity and efficiency, the tool provides personalized insights to aid in informed decision-making.
      </p>
      <p>Use the tabs above to navigate through the tool:</p>
      <ul>
        <li><strong>Instructions</strong> – Step-by-step guidance on using the tool.</li>
        <li><strong>Attributes</strong> – Detailed descriptions of the DCE attributes and levels.</li>
        <li><strong>Inputs</strong> – Enter your personal and plan-specific information.</li>
        <li><strong>WTP Results</strong> – View bar charts of Willingness to Pay (WTP) for each attribute.</li>
        <li><strong>Programme Uptake Probability</strong> – Visualize the predicted uptake probability based on your inputs.</li>
        <li><strong>Costs &amp; Benefits</strong> – Analyze the cost-effectiveness of different plan scenarios.</li>
        <li><strong>Scenarios</strong> – Save, compare, and export multiple plan scenarios.</li>
      </ul>
    </div>
  </div>

  <!-- Instructions Tab -->
  <div id="instructionsTab" class="tabcontent">
    <h2>How to Use This Tool</h2>
    <p>
      Follow these steps to effectively use the T2DM Equity-Efficiency Decision Aid Tool:
    </p>
    <ol>
      <li><strong>Select Experiment:</strong> Choose one of the three experimental conditions to understand how different perspectives influence your preferences.</li>
      <li><strong>Review Attributes:</strong> Navigate to the <strong>Attributes</strong> tab to familiarize yourself with the various attributes and their levels that describe the health insurance plans.</li>
      <li><strong>Input Your Details:</strong> In the <strong>Inputs</strong> tab, enter your demographic information and adjust the plan attributes using sliders and selection options.</li>
      <li><strong>View WTP Results:</strong> Click on the <strong>WTP Results</strong> tab to see how much you are willing to pay for improvements in each attribute.</li>
      <li><strong>Check Programme Uptake Probability:</strong> The <strong>Programme Uptake Probability</strong> tab displays a bar chart predicting the likelihood of you choosing a particular health plan based on your inputs.</li>
      <li><strong>Analyze Costs &amp; Benefits:</strong> In the <strong>Costs &amp; Benefits</strong> tab, review a comprehensive analysis of the economic implications of your selected plan.</li>
      <li><strong>Manage Scenarios:</strong> Save your current scenario, compare multiple scenarios, and export your results to PDF in the <strong>Scenarios</strong> tab.</li>
    </ol>
  </div>

  <!-- Attributes Tab -->
  <div id="attributesTab" class="tabcontent">
    <h2>Study Attributes and Levels</h2>
    <table>
      <thead>
        <tr>
          <th>Attribute</th>
          <th>Description</th>
          <th>Levels</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Chance of reaching target A1C in 6 months</td>
          <td>The expected probability of achieving target A1C (long-term blood glucose level) after taking the medication.</td>
          <td>10%, 50%, 90%</td>
        </tr>
        <tr>
          <td>Chance of side effects (e.g., gastrointestinal side effects, genital infection)</td>
          <td>The risk of experiencing side effects such as gastrointestinal issues or genital infections.</td>
          <td>0%, 8%, 16%, 30%</td>
        </tr>
        <tr>
          <td>Monthly out-of-pocket cost</td>
          <td>The amount patients are required to pay each month for the T2DM treatments.</td>
          <td>$0, $200, $500, $1000</td>
        </tr>
      </tbody>
    </table>
    <h3>Experimental Conditions</h3>
    <ol>
      <li><strong>Experiment 1: Self-focused Outcomes</strong> – Focuses exclusively on personal health outcomes and costs.</li>
      <li><strong>Experiment 2: Equal Health Outcomes for Self and Others</strong> – Introduces an egalitarian perspective by considering equal health outcomes for self and other patients with poorer health.</li>
      <li><strong>Experiment 3: Varying Health Outcomes for Self and Others</strong> – Examines preferences when health outcomes and costs vary between self and other patients with poorer health.</li>
    </ol>
  </div>

  <!-- Inputs Tab -->
  <div id="inputsTab" class="tabcontent">
    <h2>Inputs</h2>
    <form onsubmit="event.preventDefault();">
      <div class="form-grid">
        <!-- Experiment Selection -->
        <div class="form-item">
          <label for="experimentSelect"><strong>Select Experiment:</strong></label>
          <select id="experimentSelect" required>
            <option value="">--Select Experiment--</option>
            <option value="1">Experiment 1: Self-focused Outcomes</option>
            <option value="2">Experiment 2: Equal Health Outcomes for Self and Others</option>
            <option value="3">Experiment 3: Varying Health Outcomes for Self and Others</option>
          </select>
        </div>

        <!-- Demographics -->
        <div class="form-item">
          <label for="age">Age (18-120):</label>
          <input 
            type="number" 
            id="age" 
            name="age" 
            min="18" max="120" 
            placeholder="e.g., 50" 
            required
          />
        </div>

        <div class="form-item">
          <label for="gender"><strong>Gender:</strong></label>
          <select id="gender" name="gender" required>
            <option value="">--Select Gender--</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>

        <div class="form-item">
          <label for="race"><strong>Race/Ethnicity:</strong></label>
          <select id="race" name="race" required>
            <option value="">--Select Race/Ethnicity--</option>
            <option value="white">White</option>
            <option value="black">Black</option>
            <option value="asian">Asian</option>
            <option value="hispanic">Hispanic</option>
            <option value="other">Other/Not Listed</option>
          </select>
        </div>

        <div class="form-item">
          <label for="income"><strong>Income Group:</strong></label>
          <select id="income" name="income" required>
            <option value="">--Select Income Group--</option>
            <option value="low">Low Income</option>
            <option value="high">High Income</option>
          </select>
        </div>

        <div class="form-item">
          <label for="degree"><strong>Educational Qualification:</strong></label>
          <select id="degree" name="degree" required>
            <option value="">--Select Qualification--</option>
            <option value="no">No Degree</option>
            <option value="yes">Degree or Higher</option>
          </select>
        </div>

        <div class="form-item">
          <label for="goodHealth"><strong>Self-Reported Health Status:</strong></label>
          <select id="goodHealth" name="goodHealth" required>
            <option value="">--Select Health Status--</option>
            <option value="yes">Good Health</option>
            <option value="no">Poor Health</option>
          </select>
        </div>

        <!-- Plan Attributes -->
        <h3>Health Plan Attributes</h3>
        <div class="form-item">
          <label for="efficacy"><strong>Chance of reaching target A1C in 6 months:</strong></label>
          <select id="efficacy" name="efficacy" required>
            <option value="">--Select Efficacy--</option>
            <option value="10">10%</option>
            <option value="50">50%</option>
            <option value="90">90%</option>
          </select>
        </div>

        <div class="form-item">
          <label for="risk"><strong>Chance of side effects:</strong></label>
          <select id="risk" name="risk" required>
            <option value="">--Select Risk Level--</option>
            <option value="0">0%</option>
            <option value="8">8%</option>
            <option value="16">16%</option>
            <option value="30">30%</option>
          </select>
        </div>

        <div class="form-item">
          <label for="cost"><strong>Monthly out-of-pocket cost (USD):</strong></label>
          <input 
            type="range" 
            id="cost" 
            name="cost"
            min="0" 
            max="1000" 
            step="50" 
            value="200"
            oninput="updateCostDisplay(this.value)" 
          />
          <span id="costValue">200</span>
        </div>

        <!-- Additional Attributes for Experiment 3 -->
        <div class="form-item" id="efficacyOthersDiv" style="display: none;">
          <label for="efficacyOthers"><strong>Chance of reaching target A1C for Others:</strong></label>
          <select id="efficacyOthers" name="efficacyOthers">
            <option value="10">10%</option>
            <option value="50">50%</option>
            <option value="90">90%</option>
          </select>
        </div>

        <div class="form-item" id="riskOthersDiv" style="display: none;">
          <label for="riskOthers"><strong>Chance of side effects for Others:</strong></label>
          <select id="riskOthers" name="riskOthers">
            <option value="0">0%</option>
            <option value="8">8%</option>
            <option value="16">16%</option>
            <option value="30">30%</option>
          </select>
        </div>
      </div>
      <div class="buttons-row">
        <button type="button" onclick="predictUptake()">Predict Plan Uptake</button>
        <button type="button" onclick="saveCurrentResult()">Save Result</button>
      </div>
    </form>
  </div>

  <!-- WTP Results Tab -->
  <div id="wtpTab" class="tabcontent">
    <h2>Willingness to Pay (WTP) Results</h2>
    <p>
      The Willingness-to-Pay (WTP) for each attribute is calculated by taking the ratio of the attribute’s coefficient to the negative of the "Monthly out-of-pocket cost" coefficient. This metric quantifies the monetary value respondents place on each attribute, holding other factors constant.
    </p>
    <div class="buttons-row">
      <button onclick="renderWTPChart()">Show WTP Plots</button>
    </div>
    <div class="chart-grid">
      <div class="chart-box">
        <h3>WTP (USD) with Error Bars</h3>
        <canvas id="wtpChartMain"></canvas>
      </div>
    </div>
  </div>

  <!-- Programme Uptake Probability Tab -->
  <div id="probTab" class="tabcontent">
    <h2>Programme Uptake Probability</h2>
    <p>
      Click “Show Probability Plot” to compute a new bar chart based on your <strong>Inputs</strong>. Depending on whether the predicted uptake is below 30%, between 30–70%, or above 70%, you will receive suggestions for adjustments in cost, efficacy, or risk.
    </p>
    <div class="buttons-row">
      <button onclick="renderProbChart()">Show Probability Plot</button>
    </div>
    <div class="chart-grid">
      <div class="chart-box">
        <h3>Programme Uptake Probability</h3>
        <canvas id="probChartMain"></canvas>
      </div>
    </div>
  </div>

  <!-- Costs & Benefits Tab -->
  <div id="costsTab" class="tabcontent">
    <h2>Costs &amp; Benefits</h2>
    <div id="costsBenefitsContainer">
      <div class="qaly-selector">
        <label for="qalySelect"><strong>Select QALY Gain Scenario:</strong></label>
        <select id="qalySelect" onchange="renderCostsBenefits()">
          <option value="low">Low (0.02 QALYs per participant)</option>
          <option value="moderate" selected>Moderate (0.05 QALYs per participant)</option>
          <option value="high">High (0.1 QALYs per participant)</option>
        </select>
      </div>
      <div id="costsBenefitsResults">
        <!-- Results will be injected here -->
      </div>
      <p><strong>Reference:</strong> Engel, L., Lee, Y. Y., Le, L. K. D., Lal, A., &amp; Mihalopoulos, C. (2021). Reducing loneliness to prevent depression in older adults in Australia: A modelled cost-effectiveness analysis. Mental Health and Prevention, 24. <a href="https://doi.org/10.1016/j.mhp.2021.200212" target="_blank">https://doi.org/10.1016/j.mhp.2021.200212</a>.</p>
    </div>
  </div>

  <!-- Scenarios Tab -->
  <div id="scenariosTab" class="tabcontent">
    <h2>Saved Scenarios</h2>
    <p>
      Save your scenario from <strong>Inputs</strong> and compare or export multiple configurations, including WTP and uptake probability charts, to PDF.
    </p>
    <div class="buttons-row">
      <button onclick="saveScenario()">Save Current Scenario</button>
      <button onclick="openComparison()">Compare All Scenarios</button>
      <button onclick="exportToPDF()">Export Comparison to PDF</button>
    </div>
    <table id="scenarioTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Experiment</th>
          <th>Age</th>
          <th>Gender</th>
          <th>Race</th>
          <th>Income</th>
          <th>Degree</th>
          <th>Good Health</th>
          <th>Efficacy (%)</th>
          <th>Risk (%)</th>
          <th>Cost (USD)</th>
          <th>Efficacy Others (%)</th>
          <th>Risk Others (%)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Results Section -->
  <div id="resultsSection" class="tabcontent">
    <!-- This section can be used for additional dynamic results if needed -->
  </div>

  <footer>
    <p>
      &copy; 2025 T2DM Equity-Efficiency Decision Aid Tool. All Rights Reserved. <br/>
      Authors: Surachat Ngorsuraches (Auburn University, USA), Mesfin Genie (The University of Newcastle, Australia)
    </p>
  </footer>
</div>
<script src="script.js"></script>
</body>
</html>
