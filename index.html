<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>T2DM Equity-Efficiency Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Include Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Include jsPDF from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <header>
      <h1>T2DM Equity-Efficiency Decision Aid Tool</h1>
      <p>This interactive tool helps you evaluate how varying risk, efficacy, and cost attributes influence patient preferences for T2DM treatments under different equity-efficiency scenarios.</p>
    </header>

    <!-- NAVIGATION TABS -->
    <nav>
      <div class="tabs" role="tablist">
        <button class="tablink active" onclick="openTab('introTab', this)" role="tab" aria-selected="true">Introduction</button>
        <button class="tablink" onclick="openTab('instructionsTab', this)" role="tab" aria-selected="false">Instructions</button>
        <button class="tablink" onclick="openTab('attributesTab', this)" role="tab" aria-selected="false">Attributes</button>
        <button class="tablink" onclick="openTab('inputsTab', this)" role="tab" aria-selected="false">Inputs</button>
        <button class="tablink" onclick="openTab('wtpTab', this)" role="tab" aria-selected="false">WTP Results</button>
        <button class="tablink" onclick="openTab('scenariosTab', this)" role="tab" aria-selected="false">Scenarios</button>
        <button class="tablink" onclick="openTab('costsTab', this)" role="tab" aria-selected="false">Costs &amp; Benefits</button>
      </div>
    </nav>

    <!-- 1. INTRODUCTION TAB -->
    <div id="introTab" class="tabcontent" style="display: block;" role="tabpanel">
      <h2>Introduction</h2>
      <p>
        This tool is designed to evaluate health plan choices for Type 2 Diabetes Mellitus (T2DM) under different experimental conditions:
      </p>
      <ul>
        <li><strong>Experiment 1</strong>: Self-focused outcomes.</li>
        <li><strong>Experiment 2</strong>: Equal health outcomes for self and others with poorer health.</li>
        <li><strong>Experiment 3</strong>: Varying/unequal health outcomes for self and others with poorer health.</li>
      </ul>
      <p>
        By adjusting attributes such as treatment efficacy, risk of side effects, and monthly out-of-pocket costs, you can explore how preferences and willingness to pay (WTP) change. The tool also calculates the likely uptake (choice probability) of each plan and provides a cost-benefit analysis.
      </p>
    </div>

    <!-- 2. INSTRUCTIONS TAB -->
    <div id="instructionsTab" class="tabcontent" role="tabpanel">
      <h2>Instructions</h2>
      <ol>
        <li><strong>Attributes</strong>: Familiarize yourself with the key T2DM treatment attributes under different experiments.</li>
        <li><strong>Inputs</strong>: Select an experiment, set efficacy, risk, and cost attributes (sliders &amp; dropdowns). For Experiment 3, you can also adjust "others" attributes.</li>
        <li><strong>Calculate Uptake</strong>: Click “Show Probability Plot” to see the predicted plan uptake (vs. opting out).</li>
        <li><strong>WTP Results</strong>: View bar charts showing how much participants are willing to pay for changes in risk or efficacy, grouped by experiment.</li>
        <li><strong>Scenarios</strong>: Save and compare multiple scenarios. Filter or export them to PDF for documentation.</li>
        <li><strong>Costs &amp; Benefits</strong>: Select a QALY gain scenario and review cost-effectiveness metrics (e.g., net benefits, total cost).</li>
      </ol>
      <p>
        Navigate using the tabs at the top. All results update automatically based on the experiment and attribute selections you provide.
      </p>
    </div>

    <!-- 3. ATTRIBUTES TAB -->
    <div id="attributesTab" class="tabcontent" role="tabpanel">
      <h2>Attributes</h2>
      <p>Below are the main attributes that define each T2DM treatment scenario:</p>
      <div class="attributes-list">

        <!-- EFFICACY CARD -->
        <div class="attribute-card">
          <div class="attribute-icon" tabindex="0">
            <!-- SVG Icon for Efficacy -->
            <svg width="24" height="24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
              <path d="M12 2a10 10 0 100 20 
              10 10 0 000-20zm2.25 13.4l-3 
              3a1 1 0 01-1.42 0l-1.5-1.5 
              a1 1 0 011.42-1.42l.79.79 
              2.29-2.29a1 1 0 011.42 
              1.42z"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Efficacy</strong>
              <p>The percentage chance of achieving target A1C in 6 months. Ranges from moderate (50%) to high (90%).</p>
            </div>
          </div>
          <div class="attribute-content">
            <h4>Efficacy</h4>
            <p>Chance of reaching target A1C levels over a defined period.</p>
          </div>
        </div>

        <!-- RISK CARD -->
        <div class="attribute-card">
          <div class="attribute-icon" tabindex="0">
            <!-- SVG Icon for Risk -->
            <svg width="24" height="24" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2a10 10 0 100 20 
              10 10 0 000-20zm.707 
              14.293a1 1 0 11-1.414 
              1.414l-4-4a1 1 0 
              010-1.414l4-4a1 1 0 
              011.414 1.414L10.414 
              11H16a1 1 0 110 
              2h-5.586l2.293 
              2.293z"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Risk</strong>
              <p>Probability of experiencing side effects (e.g., GI or genital infections). Levels: 8%, 16%, 30%.</p>
            </div>
          </div>
          <div class="attribute-content">
            <h4>Risk</h4>
            <p>Potential side effects from the treatment at specified probabilities.</p>
          </div>
        </div>

        <!-- COST CARD -->
        <div class="attribute-card">
          <div class="attribute-icon" tabindex="0">
            <!-- SVG Icon for Cost -->
            <svg width="24" height="24" fill="#f1c40f" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#f1c40f" stroke-width="2" fill="none"/>
              <text x="8" y="16" font-size="10" fill="#f1c40f" font-weight="bold">$</text>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Monthly Out-of-Pocket Cost</strong>
              <p>The amount a patient pays each month for T2DM treatments. Adjustable between $0 and $1000.</p>
            </div>
          </div>
          <div class="attribute-content">
            <h4>Cost</h4>
            <p>Monthly out-of-pocket payment for the T2DM treatment plan.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 4. INPUTS TAB -->
    <div id="inputsTab" class="tabcontent" role="tabpanel">
      <h2>Inputs</h2>
      <p>Configure your scenario by selecting the experiment, setting efficacy, risk, and cost attributes.</p>
      <div class="form-grid">
        <!-- Experiment Selection -->
        <div class="form-item">
          <label for="experimentSelect">Experiment:</label>
          <select id="experimentSelect">
            <option value="1">Experiment 1 (Self-Focused Outcomes)</option>
            <option value="2">Experiment 2 (Equal Health Outcomes)</option>
            <option value="3">Experiment 3 (Unequal Health Outcomes)</option>
          </select>
        </div>

        <!-- Efficacy for Self -->
        <div class="form-item">
          <label for="efficacy">Efficacy for Self (%):</label>
          <select id="efficacy">
            <option value="">--Select--</option>
            <option value="50">50</option>
            <option value="90">90</option>
          </select>
        </div>

        <!-- Risk for Self -->
        <div class="form-item">
          <label for="risk">Risk for Self (%):</label>
          <select id="risk">
            <option value="">--Select--</option>
            <option value="8">8</option>
            <option value="16">16</option>
            <option value="30">30</option>
          </select>
        </div>

        <!-- Cost for Self -->
        <div class="form-item">
          <label for="cost">Monthly Out-of-Pocket Cost (Self):</label>
          <input type="range" id="cost" name="cost" min="0" max="1000" step="50" value="200" oninput="updateCostDisplay(this.value)"/>
          <span id="costValue">$200</span>
        </div>

        <!-- Experiment 3 Additional Fields -->
        <div class="form-item" id="efficacyOthersDiv" style="display: none;">
          <label for="efficacyOthers">Efficacy for Others (%):</label>
          <select id="efficacyOthers">
            <option value="">--Select--</option>
            <option value="50">50</option>
            <option value="90">90</option>
          </select>
        </div>
        <div class="form-item" id="riskOthersDiv" style="display: none;">
          <label for="riskOthers">Risk for Others (%):</label>
          <select id="riskOthers">
            <option value="">--Select--</option>
            <option value="8">8</option>
            <option value="16">16</option>
            <option value="30">30</option>
          </select>
        </div>
        <div class="form-item" id="costOthersDiv" style="display: none;">
          <label for="costOthers">Monthly Out-of-Pocket Cost (Others):</label>
          <input type="range" id="costOthers" name="costOthers" min="0" max="1000" step="50" value="200" oninput="updateCostOthersDisplay(this.value)"/>
          <span id="costOthersValue">$200</span>
        </div>
      </div>

      <div class="buttons-row">
        <button onclick="renderProbChart()">Show Probability Plot</button>
        <button onclick="saveScenario()">Save Scenario</button>
      </div>

      <!-- Probability Chart -->
      <canvas id="probChartMain" width="500" height="250" aria-label="Predicted Health Plan Uptake" role="img"></canvas>
    </div>

    <!-- 5. WTP RESULTS TAB -->
    <div id="wtpTab" class="tabcontent" role="tabpanel">
      <h2>WTP Results</h2>
      <p>The WTP for each attribute is derived from the ratio of the attribute’s coefficient to the negative of the monthly cost coefficient. Error bars represent standard errors.</p>
      <div class="buttons-row">
        <button onclick="renderWTPChart()">Show WTP Plots</button>
      </div>
      <canvas id="wtpChartMain" width="500" height="250" aria-label="WTP Bar Chart" role="img"></canvas>
      <div id="wtpConclusion" class="conclusion-section"></div>
    </div>

    <!-- 6. SCENARIOS TAB -->
    <div id="scenariosTab" class="tabcontent" role="tabpanel">
      <h2>Scenarios</h2>
      <p>Compare and export multiple scenario configurations.</p>
      <div class="filter-options">
        <label for="filterExperiment"><strong>Filter by Experiment:</strong></label>
        <select id="filterExperiment" onchange="filterScenarios()">
          <option value="all">All Experiments</option>
          <option value="Experiment 1">Experiment 1</option>
          <option value="Experiment 2">Experiment 2</option>
          <option value="Experiment 3">Experiment 3</option>
        </select>
      </div>
      <div class="buttons-row">
        <button onclick="renderWTPComparison()">Compare Average WTP for Risk Across Experiments</button>
        <button onclick="exportToPDF()">Export Comparison to PDF</button>
      </div>

      <table id="scenarioTable" aria-describedby="scenarioTable-description">
        <caption id="scenarioTable-description" class="sr-only">Table of Saved Scenarios</caption>
        <thead>
          <tr>
            <th>Name</th>
            <th>Experiment</th>
            <th>Efficacy (%)</th>
            <th>Risk (%)</th>
            <th>Cost (USD)</th>
            <th>Efficacy Others (%)</th>
            <th>Risk Others (%)</th>
            <th>Cost Others (USD)</th>
            <th>Uptake (%)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="wtpComparisonContainer" style="margin-top: 40px; display: none;">
        <h3>Average WTP for Risk Attributes Across Experiments</h3>
        <canvas id="wtpComparisonChart" width="500" height="250" aria-label="WTP Comparison Chart" role="img"></canvas>
        <p id="wtpComparisonConclusion" class="conclusion-section"></p>
      </div>
    </div>

    <!-- 7. COSTS & BENEFITS TAB -->
    <div id="costsTab" class="tabcontent" role="tabpanel">
      <h2>Costs &amp; Benefits</h2>
      <p>Analyze cost-effectiveness by selecting a QALY gain scenario below.</p>
      <div class="qaly-selector">
        <label for="qalySelect"><strong>Select QALY Gain Scenario:</strong></label>
        <select id="qalySelect" onchange="renderCostsBenefits()">
          <option value="low">Low (0.02 QALYs)</option>
          <option value="moderate" selected>Moderate (0.05 QALYs)</option>
          <option value="high">High (0.10 QALYs)</option>
        </select>
      </div>
      <div class="calculation-info">
        <h4>How Costs &amp; Benefits are Calculated</h4>
        <p>
          Fixed costs (e.g., advertisement, training) are added outright, while variable costs scale with the predicted uptake probability. Benefits are calculated by multiplying the number of participants by the QALY gain scenario, and then monetizing QALYs at $50,000 per QALY.
        </p>
      </div>
      <div id="costsBenefitsResults"></div>
    </div>

    <!-- FOOTER -->
    <footer>
      <p>
        &copy; 2025 T2DM Equity-Efficiency Decision Aid Tool. All rights reserved.<br/>
        Authors: Surachat Ngorsuraches (Auburn University, USA), Mesfin Genie (The University of Newcastle, Australia)
      </p>
    </footer>
  </div>

  <!-- SCRIPT -->
  <script src="script.js"></script>
</body>
</html>
