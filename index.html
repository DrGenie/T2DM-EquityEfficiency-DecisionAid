<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>T2DM Equity-Efficiency Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">

    <!-- HEADER -->
    <header>
      <h1>T2DM Equity-Efficiency Decision Aid Tool</h1>
      <p>
        This interactive tool helps researchers and policymakers evaluate how changes in risk, efficacy, 
        and monthly costs can shape preferences for T2DM treatments across different equity-efficiency scenarios.
        The tool is built for US-based cost assumptions and health outcome valuations.
      </p>
    </header>

    <!-- NAVIGATION TABS -->
    <nav>
      <div class="tabs" role="tablist">
        <button class="tablink active" onclick="openTab('introTab', this)" role="tab" aria-selected="true">Introduction</button>
        <button class="tablink" onclick="openTab('instructionsTab', this)" role="tab" aria-selected="false">Instructions</button>
        <button class="tablink" onclick="openTab('attributesTab', this)" role="tab" aria-selected="false">Attributes</button>
        <button class="tablink" onclick="openTab('inputsTab', this)" role="tab" aria-selected="false">Inputs</button>
        <button class="tablink" onclick="openTab('uptakeTab', this)" role="tab" aria-selected="false">Predicted Health Plan Uptake</button>
        <button class="tablink" onclick="openTab('wtpTab', this)" role="tab" aria-selected="false">WTP Results</button>
        <button class="tablink" onclick="openTab('scenariosTab', this)" role="tab" aria-selected="false">Scenarios</button>
        <button class="tablink" onclick="openTab('costsTab', this)" role="tab" aria-selected="false">Costs &amp; Benefits</button>
      </div>
    </nav>

    <!-- 1. INTRODUCTION TAB -->
    <div id="introTab" class="tabcontent" style="display: block;">
      <h2>Introduction</h2>
      <p>
        This tool evaluates how patients choose among T2DM treatment plans under three experimental conditions:
      </p>
      <ol>
        <li><strong>Experiment 1 (Self-Focused Outcomes):</strong> 
          Focus solely on personal risk, efficacy, and cost.
        </li>
        <li><strong>Experiment 2 (Equal Health Outcomes):</strong> 
          Health outcomes are shared equally between the individual and others with poorer health.
        </li>
        <li><strong>Experiment 3 (Unequal Outcomes):</strong> 
          Disparate outcomes for self and others, allowing complex trade-offs for equity considerations.
        </li>
      </ol>
      <p>
        By adjusting risk, efficacy, and monthly out-of-pocket cost, you can see how these attributes affect plan 
        uptake probability, willingness to pay (WTP), and the net cost-benefit of adopting specific T2DM interventions.
      </p>
    </div>

    <!-- 2. INSTRUCTIONS TAB -->
    <div id="instructionsTab" class="tabcontent">
      <h2>Instructions</h2>
      <ol>
        <li><strong>Attributes:</strong> Review the "Attributes" tab for details and references. Risk references 0%, while Efficacy references 10% baseline.</li>
        <li><strong>Inputs:</strong> In the "Inputs" tab, choose an experiment, then specify risk, efficacy, and cost values for “self.” 
          If Experiment 3 is chosen, also provide "others" attributes.</li>
        <li><strong>Predicted Uptake:</strong> Click “Show Probability Plot” in the "Inputs" tab. Then switch to “Predicted Health Plan Uptake” to see the chart.</li>
        <li><strong>WTP Results:</strong> Generate bar charts in the "WTP Results" tab. Negative WTP indicates disutility requiring compensation; positive WTP is a willingness to pay for improvements.</li>
        <li><strong>Scenarios:</strong> Save multiple scenarios, compare them, or export them as PDF in the "Scenarios" tab.</li>
        <li><strong>Costs &amp; Benefits:</strong> Detailed US-based cost components are listed under "Costs &amp; Benefits," with QALYs monetized at $50,000/QALY. Net benefit is benefits minus costs, factoring uptake.</li>
      </ol>
    </div>

    <!-- 3. ATTRIBUTES TAB -->
    <div id="attributesTab" class="tabcontent">
      <h2>Key Attributes for T2DM Treatments</h2>
      <div class="attributes-list">

        <!-- EFFICACY CARD -->
        <div class="attribute-card">
          <div class="attribute-icon" tabindex="0">
            <svg width="24" height="24" fill="#2980b9" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#2980b9" stroke-width="2" fill="none"/>
              <path d="M10 15l-3-3 1.4-1.4 1.6 1.6L15 7l1.4 1.4-6.4 6.4z"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Efficacy</strong>
              <p>Chance of reaching target A1C in 6 months. E.g., 10% baseline, 50% moderate, 90% high.</p>
            </div>
          </div>
          <div class="attribute-content">
            <h4>Efficacy</h4>
            <p>Higher efficacy suggests stronger T2DM control outcomes.</p>
          </div>
        </div>

        <!-- RISK CARD -->
        <div class="attribute-card">
          <div class="attribute-icon" tabindex="0">
            <svg width="24" height="24" fill="#e74c3c" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#e74c3c" stroke-width="2" fill="none"/>
              <path d="M12 7v5m0 3v2"/>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Risk</strong>
              <p>Chance of side effects above a 0% baseline, set at 8%, 16%, or 30% for side-effect risk.</p>
            </div>
          </div>
          <div class="attribute-content">
            <h4>Risk</h4>
            <p>A higher percentage risk means greater side-effect likelihood requiring compensation.</p>
          </div>
        </div>

        <!-- COST CARD -->
        <div class="attribute-card">
          <div class="attribute-icon" tabindex="0">
            <svg width="24" height="24" fill="#f1c40f" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="#f1c40f" stroke-width="2" fill="none"/>
              <text x="8" y="16" font-size="10" fill="#f1c40f" font-weight="bold">$</text>
            </svg>
            <div class="tooltip" role="tooltip">
              <strong>Cost</strong>
              <p>Monthly out-of-pocket cost from $0 to $1000. Higher costs reduce uptake likelihood.</p>
            </div>
          </div>
          <div class="attribute-content">
            <h4>Monthly Out-of-Pocket Cost</h4>
            <p>The direct monthly expenditure for T2DM treatments.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 4. INPUTS TAB -->
    <div id="inputsTab" class="tabcontent">
      <h2>Scenario Inputs</h2>
      <p>Choose an experiment, set risk and efficacy for “self,” and if needed, “others.” Then click "Show Probability Plot."</p>
      <div class="form-grid">

        <div class="form-item">
          <label for="experimentSelect">Select Experiment:</label>
          <select id="experimentSelect">
            <option value="">--Select Experiment--</option>
            <option value="1">Experiment 1 (Self-Focused)</option>
            <option value="2">Experiment 2 (Equal Outcomes)</option>
            <option value="3">Experiment 3 (Unequal Outcomes)</option>
          </select>
        </div>
        <div class="form-item">
          <label for="efficacy">Efficacy (Self) % (Ref=10%):</label>
          <select id="efficacy">
            <option value="">--Select Efficacy--</option>
            <option value="50">50</option>
            <option value="90">90</option>
          </select>
        </div>
        <div class="form-item">
          <label for="risk">Risk (Self) % (Ref=0%):</label>
          <select id="risk">
            <option value="">--Select Risk--</option>
            <option value="8">8</option>
            <option value="16">16</option>
            <option value="30">30</option>
          </select>
        </div>
        <div class="form-item">
          <label for="cost">Monthly Out-of-Pocket (Self):</label>
          <input type="range" id="cost" name="cost" min="0" max="1000" step="50" value="200" oninput="updateCostDisplay(this.value)"/>
          <span id="costValue">$200</span>
        </div>

        <!-- For Experiment 3 -->
        <div class="form-item" id="efficacyOthersDiv" style="display: none;">
          <label for="efficacyOthers">Efficacy (Others) % (Ref=10%):</label>
          <select id="efficacyOthers">
            <option value="">--Select--</option>
            <option value="50">50</option>
            <option value="90">90</option>
          </select>
        </div>
        <div class="form-item" id="riskOthersDiv" style="display: none;">
          <label for="riskOthers">Risk (Others) % (Ref=0%):</label>
          <select id="riskOthers">
            <option value="">--Select--</option>
            <option value="8">8</option>
            <option value="16">16</option>
            <option value="30">30</option>
          </select>
        </div>
        <div class="form-item" id="costOthersDiv" style="display: none;">
          <label for="costOthers">Monthly Out-of-Pocket (Others):</label>
          <input type="range" id="costOthers" name="costOthers" min="0" max="1000" step="50" value="200" oninput="updateCostOthersDisplay(this.value)"/>
          <span id="costOthersValue">$200</span>
        </div>
      </div>
      <div class="buttons-row">
        <button onclick="renderProbChart()">Show Probability Plot</button>
        <button onclick="saveScenario()">Save Scenario</button>
      </div>
    </div>

    <!-- 5. PREDICTED HEALTH PLAN UPTAKE TAB -->
    <div id="uptakeTab" class="tabcontent">
      <h2>Predicted Health Plan Uptake</h2>
      <p>
        This chart displays the likelihood of selecting the specified plan over opting out, 
        after clicking “Show Probability Plot” in the "Inputs" tab.
      </p>
      <canvas id="probChartMain" width="600" height="300" aria-label="Probability Chart" role="img"></canvas>
    </div>

    <!-- 6. WTP RESULTS TAB -->
    <div id="wtpTab" class="tabcontent">
      <h2>Willingness to Pay (WTP) Results</h2>
      <p>
        This section shows how much participants are willing to pay for changes in risk 
        or efficacy attributes, based on discrete choice model estimates. Negative WTP indicates 
        a disutility requiring monetary compensation, while positive WTP indicates a willingness 
        to pay for improving that attribute.
      </p>
      <div class="buttons-row">
        <button onclick="renderWTPChart()">Show WTP Plots</button>
      </div>
      <canvas id="wtpChartMain" width="600" height="300" aria-label="WTP Chart" role="img"></canvas>
      <div id="wtpConclusion" class="conclusion-section"></div>
    </div>

    <!-- 7. SCENARIOS TAB -->
    <div id="scenariosTab" class="tabcontent">
      <h2>Scenarios</h2>
      <p>Save and compare multiple configurations, then export them to PDF if needed.</p>
      <div class="filter-options">
        <label for="filterExperiment"><strong>Filter by Experiment:</strong></label>
        <select id="filterExperiment" onchange="filterScenarios()">
          <option value="all">All Experiments</option>
          <option value="Experiment 1">Experiment 1</option>
          <option value="Experiment 2">Experiment 2</option>
          <option value="Experiment 3">Experiment 3</option>
        </select>
      </div>
      <div class="buttons-row">
        <button onclick="renderWTPComparison()">Compare Average WTP for Risk</button>
        <button onclick="exportToPDF()">Export Comparison to PDF</button>
      </div>
      <table id="scenarioTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Experiment</th>
            <th>Efficacy (%)</th>
            <th>Risk (%)</th>
            <th>Cost (USD)</th>
            <th>Efficacy Others (%)</th>
            <th>Risk Others (%)</th>
            <th>Cost Others (USD)</th>
            <th>Uptake (%)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="wtpComparisonContainer" style="margin-top: 40px; display: none;">
        <h3>Average WTP for Risk Attributes Across Experiments</h3>
        <canvas id="wtpComparisonChart" width="600" height="300"></canvas>
        <p id="wtpComparisonConclusion" class="conclusion-section"></p>
      </div>
    </div>

    <!-- 8. COSTS & BENEFITS TAB -->
    <div id="costsTab" class="tabcontent">
      <h2>Costs &amp; Benefits</h2>
      <p>
        We consider a targeted list of cost components relevant to T2DM management in the USA 
        (advertising, training, medication, monitoring, etc.). 
        Some costs are fixed, while others scale with uptake probability. 
        Benefits are valued in terms of Quality-Adjusted Life Years (QALYs) gained from improved 
        T2DM control, monetized at a standard $50,000 per QALY.
      </p>
      <div class="qaly-selector">
        <label for="qalySelect"><strong>Select QALY Gain Scenario:</strong></label>
        <select id="qalySelect" onchange="renderCostsBenefits()">
          <option value="low">Low (0.02 QALYs gained)</option>
          <option value="moderate" selected>Moderate (0.05 QALYs gained)</option>
          <option value="high">High (0.10 QALYs gained)</option>
        </select>
      </div>
      <div id="costsBenefitsResults"></div>
    </div>

    <!-- FOOTER -->
    <footer>
      <p>
        &copy; 2025 T2DM Equity-Efficiency Decision Aid. All Rights Reserved. <br/>
        Authors: Surachat Ngorsuraches (Auburn University, USA), Mesfin Genie (The University of Newcastle, Australia)
      </p>
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>
